# Архитектура системы индивидуальных уроков

## Обзор

Система теперь поддерживает индивидуальные уроки, задания и материалы для каждого ученика. Админ может создавать уникальные материалы для каждого ученика и контролировать доступ к следующим урокам после проверки заданий.

## Новые модели

### 1. Material (Материалы)
- **Назначение**: Хранит материалы (PDF, видео, текст, ссылки) для уроков
- **Поля**:
  - `title` - название материала
  - `description` - описание
  - `material_type` - тип (pdf, video, text, link)
  - `file` - файл PDF (если тип pdf)
  - `video_url` - URL видео (если тип video)
  - `content` - текстовое содержимое (если тип text)
  - `link_url` - URL ссылки (если тип link)
  - `lesson` - связь с уроком (опционально)
  - `created_by` - кто создал материал

### 2. StudentLesson (Индивидуальный урок ученика)
- **Назначение**: Управляет доступом ученика к конкретному уроку
- **Поля**:
  - `student` - ученик
  - `lesson` - урок
  - `is_unlocked` - разблокирован ли урок
  - `is_completed` - завершен ли урок
  - `completed_at` - дата завершения

### 3. StudentMaterial (Материалы ученика)
- **Назначение**: Управляет доступом ученика к материалам
- **Поля**:
  - `student` - ученик
  - `material` - материал
  - `is_unlocked` - разблокирован ли материал
  - `unlocked_at` - когда разблокирован
  - `unlocked_by` - кто разблокировал (админ/учитель)

### 4. StudentChallenge (Индивидуальное задание)
- **Назначение**: Индивидуальное задание для конкретного ученика
- **Поля**:
  - `student` - ученик
  - `lesson` - урок
  - `instructions` - инструкции
  - `initial_code` - начальный код
  - `expected_output` - ожидаемый вывод
  - `hints` - подсказки

### 5. Submission (Отправленное задание)
- **Назначение**: Хранит отправленные задания от учеников для проверки админом
- **Поля**:
  - `student` - ученик
  - `lesson` - урок
  - `code` - код, который отправил ученик
  - `output` - вывод кода
  - `error` - ошибка (если была)
  - `passed_auto_check` - прошел ли автоматическую проверку
  - `status` - статус (pending, approved, rejected)
  - `admin_comment` - комментарий админа
  - `reviewed_by` - кто проверил
  - `reviewed_at` - когда проверено

## API Endpoints

### Материалы
- `GET /api/materials/` - список материалов
- `POST /api/materials/` - создать материал (только админ/учитель)
- `GET /api/materials/{id}/` - получить материал
- `PUT/PATCH /api/materials/{id}/` - обновить материал
- `DELETE /api/materials/{id}/` - удалить материал

### Индивидуальные уроки учеников
- `GET /api/student-lessons/` - список уроков ученика
- `POST /api/student-lessons/` - создать индивидуальный урок
- `GET /api/student-lessons/{id}/` - получить урок
- `POST /api/student-lessons/{id}/unlock/` - разблокировать урок
- `POST /api/student-lessons/{id}/complete/` - отметить как завершенный

### Материалы учеников
- `GET /api/student-materials/` - список материалов ученика
- `POST /api/student-materials/` - создать связь материал-ученик
- `POST /api/student-materials/{id}/unlock/` - разблокировать материал (только админ/учитель)

### Индивидуальные задания
- `GET /api/student-challenges/` - список заданий ученика
- `POST /api/student-challenges/` - создать индивидуальное задание
- `GET /api/student-challenges/{id}/` - получить задание

### Отправленные задания
- `GET /api/submissions/` - список отправленных заданий
  - Параметры: `student`, `lesson`, `status`
- `POST /api/submissions/` - создать отправку (автоматически при check_code)
- `GET /api/submissions/{id}/` - получить отправку
- `POST /api/submissions/{id}/approve/` - одобрить задание (только админ/учитель)
- `POST /api/submissions/{id}/reject/` - отклонить задание (только админ/учитель)

### Проверка кода (обновлено)
- `POST /api/check_code/` - проверяет код и автоматически создает Submission

## Процесс работы

1. **Админ создает материалы**:
   - Создает Material через `/api/materials/`
   - Может привязать к уроку или создать независимый материал

2. **Админ назначает материалы ученикам**:
   - Создает StudentMaterial через `/api/student-materials/`
   - Изначально материал заблокирован (`is_unlocked=False`)

3. **Админ создает индивидуальные задания**:
   - Создает StudentChallenge через `/api/student-challenges/`
   - Если не создано, используется общий Challenge из урока

4. **Ученик выполняет задание**:
   - Выполняет код в Lua редакторе
   - При нажатии "Проверить" вызывается `/api/check_code/`
   - Система автоматически создает Submission

5. **Админ проверяет задание**:
   - Просматривает отправки через `/api/submissions/?status=pending`
   - Одобряет через `/api/submissions/{id}/approve/`
   - При одобрении автоматически разблокируется следующий урок и материалы

6. **Ученик получает доступ**:
   - После одобрения задания админом, следующий урок разблокируется
   - Админ может вручную разблокировать материалы через `/api/student-materials/{id}/unlock/`

## Загрузка PDF файлов

PDF файлы загружаются через поле `file` модели Material:
- Валидация: только файлы с расширением `.pdf`
- Хранение: `media/materials/`
- URL: доступен через `file_url` в сериализаторе

## Права доступа

- **Студенты**: могут только просматривать свои уроки, материалы и отправки
- **Учителя/Админы**: могут создавать материалы, назначать их ученикам, проверять задания и разблокировать доступ

